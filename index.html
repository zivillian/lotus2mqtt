<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Lotus Geetest</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    </head>
    <body>
        <div class="container">
            <main role="main" class="pb-3">
                <h1>lotus2mqtt Geetest Captcha</h1>
                <p>
                    Lotus Login requires a geetest.com captcha. This site loads the captcha (which was for me always solved without any user interaction).
                    As soon as the captcha response is available you can click the button below to copy the result to your clipboard.
                </p>
                <div id="captcha"></div>
                <button id="js-copy-button" class="btn btn-primary" disabled>Copy captcha to clipboard</button>
                <a href="" class="btn btn-danger">Reload</a>
            </main>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
        <script src="gt4.js"></script>
        <script type="text/javascript">
            (function(){
                const config = {
                    captchaId: "32b68e20f3452bce5702a6ab3dc7bbf3",
                    hideBar: ['close', 'refresh'],
                    hideSuccess: true,
                    product: "bind",
                    language: "de-DE"
                };
                initGeetest4(config, function(captcha){
                    const captchaElem = document.getElementById('captcha');
                    captcha.appendTo(captchaElem)
                    .onSuccess(function(){
                        console.log('Success');
                        const result = captcha.getValidate();
                        const button = document.getElementById('js-copy-button');
                        button.dataset.captcha = JSON.stringify(result);
                        button.onclick = (e)=>{
                            navigator.clipboard.writeText(e.currentTarget.dataset.captcha);
                            alert("copied");
                        }
                        button.disabled = false;
                    })
                    .onReady(function(){
                        console.log('Ready');
                        captcha.showBox();
                    })
                    .onError(function(){
                        console.log('Error');
                    });
                });
            })();
        </script>
    </body>
</html>